(()=>{function t(t,i){let n=t.i.t();for(let e of i)e(t,n);return n}function i(t,i,n){let e=t.createShader(i);return t.shaderSource(e,n),t.compileShader(e),e}function n(t,i,n){let e=i[0],o=i[1],s=i[2],h=i[3],r=i[4],c=i[5],u=i[6],a=i[7],l=i[8],f=i[9],d=i[10],m=i[11],w=i[12],v=i[13],p=i[14],_=i[15],M=n[0],T=n[1],x=n[2],g=n[3];return t[0]=M*e+T*r+x*l+g*w,t[1]=M*o+T*c+x*f+g*v,t[2]=M*s+T*u+x*d+g*p,t[3]=M*h+T*a+x*m+g*_,M=n[4],T=n[5],x=n[6],g=n[7],t[4]=M*e+T*r+x*l+g*w,t[5]=M*o+T*c+x*f+g*v,t[6]=M*s+T*u+x*d+g*p,t[7]=M*h+T*a+x*m+g*_,M=n[8],T=n[9],x=n[10],g=n[11],t[8]=M*e+T*r+x*l+g*w,t[9]=M*o+T*c+x*f+g*v,t[10]=M*s+T*u+x*d+g*p,t[11]=M*h+T*a+x*m+g*_,M=n[12],T=n[13],x=n[14],g=n[15],t[12]=M*e+T*r+x*l+g*w,t[13]=M*o+T*c+x*f+g*v,t[14]=M*s+T*u+x*d+g*p,t[15]=M*h+T*a+x*m+g*_,t}function e(t,i=[.9,.9,.9,1],n=16640){return(e,o)=>{e.i.o[o]|=1,e.i.h[o]={u:0,l:t,m:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],v:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p:[0,0,0],_:i,M:t.T,g:i,F:n}}}function o(t,i){let n=t.i.P[i],e=t.i.$[i];n.C&&(e.C[0]=n.C[0],e.C[1]=n.C[1],t.i.o[i]|=16),n.S&&(e.S=n.S,t.i.o[i]|=16)}function s(t,i,n){return t[0]=i[0]+n[0],t[1]=i[1]+n[1],t}function h(t,i,n){return t[0]=i[0]*n,t[1]=i[1]*n,t}function r(t,i,n){let e=t.i.X[i],o=t.i.$[i];if(o.C[0]||o.C[1]){X[0]=o.C[0],X[1]=o.C[1];let i=Math.min(1,Math.hypot((r=X)[0],r[1]));(function(t,i,n){let e=i[0],o=i[1];t[0]=n[0]*e+n[2]*o,t[1]=n[1]*e+n[3]*o})(X,X,void 0!==e.Y?t.i.X[e.Y].k:e.i),function(t,i){let n=i[0],e=i[1],o=n*n+e*e;o>0&&(o=1/Math.sqrt(o)),t[0]=i[0]*o,t[1]=i[1]*o}(X,X),h(X,X,i*o.A*n),s(e.I,e.I,X),o.C[0]=0,o.C[1]=0}var r;o.S&&(e.S+=o.S*o.D*n,o.S=0)}function c(t=0,i=1){return((Y=16807*Y%2147483647)-1)/2147483646*(i-t)+t}function u(t,i){return(n,e)=>{n.i.o[e]|=128,n.i.R[e]={u:t,V:i,K:[0,0],U:[0,0]}}}function a(t,i,n){let e=t.i.X[i],o=t.i.R[i];if(1===o.u){let i=-t.j/2/z;e.I[1]<i&&(e.I[1]=i,o.U[1]*=c(-3,-1))}}function l(t,i,n){let e=t.i.X[i],o=t.i.R[i];if(1===o.u){h(o.K,o.K,n),s(o.U,o.U,o.K),h(o.U,o.U,o.V),o.U[1]+=-9.81*n;let c=[0,0];h(c,o.U,n),s(e.I,e.I,c),t.i.o[i]|=16,(r=o.K)[0]=0,r[1]=0}var r}function f(t,i){let n=t.W;t.q.useProgram(n.G),t.q.uniformMatrix4fv(n.L.v,!1,i.v),t.q.activeTexture(33984),t.q.bindTexture(g,t.N["ziemniak.png"]),t.q.uniform1i(n.L.O,0),t.q.bindBuffer(x,t.B),t.q.bufferData(x,t.H,35040),t.q.drawArraysInstanced(n.J,0,4,t.i.o.length)}function d(t,i,n,e){let o=n/e/2;!function(t,i,n,e,o,s,h){let r=1/(o-n),c=1/(e-i),u=1/(s-h);t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(o+n)*r,t[13]=(i+e)*c,t[14]=(h+s)*u,t[15]=1}(t.l,o,o*i,-o,-o*i,t.Z,t.T),function(t,i){let n=i[0],e=i[1],o=i[2],s=i[3],h=i[4],r=i[5],c=i[6],u=i[7],a=i[8],l=i[9],f=i[10],d=i[11],m=i[12],w=i[13],v=i[14],p=i[15],_=n*r-e*h,M=n*c-o*h,T=n*u-s*h,x=e*c-o*r,g=e*u-s*r,y=o*u-s*c,F=a*w-l*m,P=a*v-f*m,$=a*p-d*m,C=l*v-f*w,S=l*p-d*w,X=f*p-d*v,Y=_*X-M*S+T*C+x*$-g*P+y*F;Y&&(Y=1/Y,t[0]=(r*X-c*S+u*C)*Y,t[1]=(o*S-e*X-s*C)*Y,t[2]=(w*y-v*g+p*x)*Y,t[3]=(f*g-l*y-d*x)*Y,t[4]=(c*$-h*X-u*P)*Y,t[5]=(n*X-o*$+s*P)*Y,t[6]=(v*T-m*y-p*M)*Y,t[7]=(a*y-f*T+d*M)*Y,t[8]=(h*S-r*$+u*F)*Y,t[9]=(e*$-n*S-s*F)*Y,t[10]=(m*g-w*T+p*_)*Y,t[11]=(l*T-a*g-d*_)*Y,t[12]=(r*P-h*C-c*F)*Y,t[13]=(n*C-e*P+o*F)*Y,t[14]=(w*M-m*x-v*_)*Y,t[15]=(a*x-l*M+f*_)*Y)}(t.tt,t.l)}function m(t,i,n,e){let o=Math.sin(n),s=Math.cos(n);return t[0]=s*e[0],t[1]=o*e[0],t[2]=-o*e[1],t[3]=s*e[1],t[4]=i[0],t[5]=i[1],t}function w(t,i,n){var e,o;if(t.o[i]&=-17,m(n.i,n.I,n.S*b,n.it),void 0!==n.Y&&(function(t,i,n){let e=i[0],o=i[1],s=i[2],h=i[3],r=i[4],c=i[5],u=n[0],a=n[1],l=n[2],f=n[3],d=n[4],m=n[5];t[0]=e*u+s*a,t[1]=o*u+h*a,t[2]=e*l+s*f,t[3]=o*l+h*f,t[4]=e*d+s*m+r,t[5]=o*d+h*m+c}(n.i,t.X[n.Y].i,n.i),n.Gyroscope&&((e=k)[0]=(o=n.i)[4],e[1]=o[5],m(n.i,k,n.S*b,n.it))),function(t,i){let n=i[0],e=i[1],o=i[2],s=i[3],h=i[4],r=i[5],c=n*s-e*o;c&&(c=1/c,t[0]=s*c,t[1]=-e*c,t[2]=-o*c,t[3]=n*c,t[4]=(o*r-s*h)*c,t[5]=(e*h-n*r)*c)}(n.k,n.i),8&t.o[i]){let n=t.nt[i];for(let e=0;e<n.nt.length;e++){let o=n.nt[e];if(256&t.o[o]){let n=t.X[o];n.Y=i,w(t,o,n)}}}}function v(t,i,n,e){let o=~~(6*t),s=6*t-o,h=n*(1-i),r=n*(1-s*i),c=n*(1-(1-s)*i);switch(o%6){case 0:return[n,c,h,e];case 1:return[r,n,h,e];case 2:return[h,n,c,e];case 3:return[h,r,n,e];case 4:return[c,h,n,e];default:return[n,h,r,e]}}function p(t){return(i,n)=>{let e=n*A;i.H[e+6]=0,i.H[e+7]=1,i.H[e+8]=t[0],i.H[e+9]=t[1],i.H[e+10]=t[2],i.H[e+11]=t[3],i.i.o[n]|=64,i.i.et[n]={ot:i.H.subarray(e+6,e+8),st:i.H.subarray(e+8,e+12)}}}function _(t){return(i,n)=>{i.H[n*A+6]=t}}function M(t=[0,0],i=0,n=[1,1]){return(e,o)=>{e.i.o[o]|=272,e.i.X[o]={i:e.H.subarray(o*A,o*A+6),k:[1,0,0,1,0,0],I:t,S:i,it:n,Gyroscope:!1}}}async function T(t,i){let n=await(e="../textures/"+i+".webp",new Promise((t=>{let i=new Image;i.src=e,i.onload=()=>t(i)})));var e;t.N[i]=function(t,i){let n=t.createTexture();return t.bindTexture(g,n),t.texImage2D(g,0,6408,6408,5121,i),t.generateMipmap(g),t.texParameteri(g,10241,9986),t.texParameteri(g,10240,9729),t.texParameteri(g,10242,10497),t.texParameteri(g,10243,10497),n}(t.q,n)}var x=34962,g=3553,y=5126,F=document.getElementById("update"),P=document.getElementById("delta"),$=document.getElementById("fps"),C=1/60,S=class extends class{constructor(t=1e4){this.o=[],this.ht=[],this.rt=t}t(){return this.ht.length>0?this.ht.pop():this.o.push(0)-1}ct(t){this.o[t]=0,this.ht.push(t)}}{constructor(){super(...arguments),this.h=[],this.P=[],this.ut=[],this.nt=[],this.$=[],this.et=[],this.R=[],this.X=[]}},X=[0,0],Y=1,b=Math.PI/180,k=[0,0],A=16,I=4*A,z=32,D=Float32Array.from([-.5,-.5,0,0,0,.5,-.5,0,1,0,-.5,.5,0,0,1,.5,.5,0,1,1]),R=new class extends class extends class{constructor(){this.lt=0,this.ft=0,this.dt=window.innerWidth,this.j=window.innerHeight,this.wt=!0,this.vt={MouseX:0,MouseY:0},this._t={MouseX:0,MouseY:0},this.Mt={Mouse:0,Mouse0:0,Mouse1:0,Mouse2:0,Touch0:0,Touch1:0},this.Tt={},this.xt=document.querySelector("main"),document.addEventListener("visibilitychange",(()=>document.hidden?this.gt():this.yt())),this.xt.addEventListener("contextmenu",(t=>t.preventDefault())),this.xt.addEventListener("mousedown",(t=>{this.vt["Mouse"+t.button]=1,this._t["Mouse"+t.button]=1})),this.xt.addEventListener("mouseup",(t=>{this.vt["Mouse"+t.button]=0,this._t["Mouse"+t.button]=-1})),this.xt.addEventListener("mousemove",(t=>{this.vt.MouseX=t.clientX,this.vt.MouseY=t.clientY,this._t.MouseX=t.movementX,this._t.MouseY=t.movementY})),this.xt.addEventListener("wheel",(t=>{t.preventDefault(),this._t.WheelY=t.deltaY})),this.xt.addEventListener("touchstart",(t=>{t.target===this.xt&&t.preventDefault(),1===t.touches.length&&(this.Tt={});for(let i=0;i<t.touches.length;i++)this.Tt[t.touches[i].identifier]=i;for(let i=0;i<t.changedTouches.length;i++){let n=t.changedTouches[i],e=this.Tt[n.identifier];this.vt["Touch"+e]=1,this.vt[`Touch${e}X`]=n.clientX,this.vt[`Touch${e}Y`]=n.clientY,this._t["Touch"+e]=1,this._t[`Touch${e}X`]=0,this._t[`Touch${e}Y`]=0}})),this.xt.addEventListener("touchmove",(t=>{t.target===this.xt&&t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){let n=t.changedTouches[i],e=this.Tt[n.identifier];this._t[`Touch${e}X`]=n.clientX-this.vt[`Touch${e}X`],this._t[`Touch${e}Y`]=n.clientY-this.vt[`Touch${e}Y`],this.vt[`Touch${e}X`]=n.clientX,this.vt[`Touch${e}Y`]=n.clientY}})),this.xt.addEventListener("touchend",(t=>{t.target===this.xt&&t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){let n=this.Tt[t.changedTouches[i].identifier];this.vt["Touch"+n]=0,this._t["Touch"+n]=-1}})),this.xt.addEventListener("touchcancel",(t=>{for(let i=0;i<t.changedTouches.length;i++){let n=this.Tt[t.changedTouches[i].identifier];this.vt["Touch"+n]=0,this._t["Touch"+n]=-1}})),window.addEventListener("keydown",(t=>{t.repeat||(this.vt[t.code]=1,this._t[t.code]=1)})),window.addEventListener("keyup",(t=>{this.vt[t.code]=0,this._t[t.code]=-1}))}yt(){let t=0,i=performance.now(),n=e=>{let o=(e-i)/1e3;for(i=e,this.lt=requestAnimationFrame(n),this.Ft(o),t+=o;t>=C;)t-=C,this.Pt(C);this.$t(o),this.Ct(o)};this.gt(),n(i)}gt(){cancelAnimationFrame(this.lt),this.lt=0}Ft(t){this.ft=performance.now();let i=Math.abs(this._t.MouseX)+Math.abs(this._t.MouseY);this.Mt.Mouse+=i,1===this.vt.Mouse0&&(this.Mt.Mouse0+=i),1===this.vt.Mouse1&&(this.Mt.Mouse1+=i),1===this.vt.Mouse2&&(this.Mt.Mouse2+=i),1===this.vt.Touch0&&(this.Mt.Touch0+=Math.abs(this._t.Touch0X)+Math.abs(this._t.Touch0Y)),1===this.vt.Touch1&&(this.Mt.Touch1+=Math.abs(this._t.Touch1X)+Math.abs(this._t.Touch1Y))}Pt(t){}$t(t){}Ct(t){this.wt=!1,-1===this._t.Mouse0&&(this.Mt.Mouse0=0),-1===this._t.Mouse1&&(this.Mt.Mouse1=0),-1===this._t.Mouse2&&(this.Mt.Mouse2=0),-1===this._t.Touch0&&(this.Mt.Touch0=0),-1===this._t.Touch1&&(this.Mt.Touch1=0);for(let t in this._t)this._t[t]=0;let i=performance.now()-this.ft;F&&(F.textContent=i.toFixed(1)),P&&(P.textContent=(1e3*t).toFixed(1)),$&&($.textContent=(1/t).toFixed())}}{constructor(){super(),this.St=document.querySelector("#billboard"),this.Xt=this.St.getContext("2d"),this.Yt=document.querySelector("#scene"),this.q=this.Yt.getContext("webgl2"),this.Audio=new AudioContext,this.bt=[],this.kt={},this.q.enable(2929),this.q.enable(2884),this.q.blendFunc(770,771)}Ft(t){super.Ft(t),this.bt=[]}}{constructor(){super(),this.i=new S(50001),this.W=function(t){let n=function(t,n,e){let o=t.createProgram();return t.attachShader(o,i(t,35633,"#version 300 es\n\nuniform mat4 pv;\n\n\nin vec4 attr_position;\nin vec2 attr_texcoord;\n\n\nin vec4 attr_rotation; \nin vec4 attr_translation; \nin vec4 attr_color;\n\nout vec4 vert_color;\nout vec2 vert_texcoord;\n\nvoid main() {\nmat4 world = mat4(\nattr_rotation.xy, 0, 0,\nattr_rotation.zw, 0, 0,\n0, 0, 1, 0,\nattr_translation.xyz, 1\n);\n\nvec4 world_position = world * attr_position;\ngl_Position = pv * world_position;\nif (attr_translation.w == 0.0) {\ngl_Position.z = 2.0;\n}\n\nvert_color = attr_color;\nvert_texcoord = attr_texcoord;\n}\n")),t.attachShader(o,i(t,35632,"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D sheet;\n\nin vec4 vert_color;\nin vec2 vert_texcoord;\n\nout vec4 frag_color;\n\nvoid main() {\nfrag_color = vert_color * texture(sheet, vert_texcoord);\nif (frag_color.a == 0.0) {\ndiscard;\n}\n}\n")),t.linkProgram(o),o}(t);return{J:5,G:n,L:{v:t.getUniformLocation(n,"pv"),i:t.getUniformLocation(n,"world"),O:t.getUniformLocation(n,"sheet"),At:t.getAttribLocation(n,"attr_position"),It:t.getAttribLocation(n,"attr_texcoord"),zt:t.getAttribLocation(n,"attr_rotation"),Dt:t.getAttribLocation(n,"attr_translation"),Rt:t.getAttribLocation(n,"attr_color")}}}(this.q),this.N={},this.H=new Float32Array(this.i.rt*A),this.B=this.q.createBuffer();let t=this.W,n=this.q.createBuffer();this.q.bindBuffer(x,n),this.q.bufferData(x,D,35044),this.q.enableVertexAttribArray(t.L.At),this.q.vertexAttribPointer(t.L.At,3,y,!1,20,0),this.q.enableVertexAttribArray(t.L.It),this.q.vertexAttribPointer(t.L.It,2,y,!1,20,12),this.q.bindBuffer(x,this.B),this.q.bufferData(x,this.i.rt*I,35040),this.q.enableVertexAttribArray(t.L.zt),this.q.vertexAttribDivisor(t.L.zt,1),this.q.vertexAttribPointer(t.L.zt,4,y,!1,I,0),this.q.enableVertexAttribArray(t.L.Dt),this.q.vertexAttribDivisor(t.L.Dt,1),this.q.vertexAttribPointer(t.L.Dt,4,y,!1,I,16),this.q.enableVertexAttribArray(t.L.Rt),this.q.vertexAttribDivisor(t.L.Rt,1),this.q.vertexAttribPointer(t.L.Rt,4,y,!1,I,32)}$t(t){!function(t,i){if(t.dt==window.innerWidth&&t.j==window.innerHeight||(t.wt=!0),t.wt){t.dt=t.Yt.width=t.St.width=window.innerWidth,t.j=t.Yt.height=t.St.height=window.innerHeight;for(let i=0;i<t.i.o.length;i++)if(1==(1&t.i.o[i])){let n=t.i.h[i];if(0==n.u&&1==n.l.u){d(n.l,t.dt/t.j,t.j,z);break}}}}(this),function(t,i){for(let i=0;i<t.i.o.length;i++)if(257==(257&t.i.o[i])){let e=t.i.h[i];if(0!==e.u)throw Error("Only canvas cameras are supported.");let o=e.l,s=t.i.X[i];e.m[0]=s.k[0],e.m[1]=s.k[1],e.m[4]=s.k[2],e.m[5]=s.k[3],e.m[12]=s.k[4],e.m[13]=s.k[5],e.m[14]=-2,n(e.v,o.l,e.m),e.p[0]=s.i[4],e.p[1]=s.i[5],e.p[2]=2,t.bt.push(i)}}(this),function(t,i){for(let i=0;i<t.i.o.length;i++)34==(34&t.i.o[i])&&o(t,i)}(this),function(t,i){for(let n=0;n<t.i.o.length;n++)304==(304&t.i.o[n])&&r(t,n,i)}(this,t),function(t,i){for(let n=0;n<t.i.o.length;n++)384==(384&t.i.o[n])&&l(t,n,i)}(this,t),function(t,i){for(let i=0;i<t.i.o.length;i++)272==(272&t.i.o[i])&&w(t.i,i,t.i.X[i])}(this),function(t,i){for(let i=0;i<t.i.o.length;i++)384==(384&t.i.o[i])&&a(t,i)}(this),function(t,i){for(let i=0;i<t.i.o.length;i++){let n=i*A+7;64&t.i.o[i]?0==t.H[n]&&(t.H[n]=1):1==t.H[n]&&(t.H[n]=0)}for(let i of t.bt){let n=t.i.h[i];0===n.u&&(t.q.bindFramebuffer(36160,null),t.q.viewport(0,0,t.dt,t.j),t.q.clearColor(...n.g),t.q.clear(n.F),f(t,n))}}(this)}};window.game=R,Promise.all([T(R,"checker1.png"),T(R,"ziemniak.png")]).then((()=>{!function(i){i.i=new S(50001),i.wt=!0,t(i,[M([0,0]),e({u:1,Vt:5,Z:1,T:3,l:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tt:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]})]);for(let n=0;n<5e3;n++)t(i,[M([c(-10,10),c(9,10)],0),p(v(c(.1,.2),.5,1,1)),_(1-n/5e3),u(1,c(.98,.99))])}(R),R.yt()}))})();
