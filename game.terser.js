(()=>{function t(t,i){let n=t.i.t();for(let e of i)e(t,n);return n}function i(t,i,n){let e=t.createShader(i);return t.shaderSource(e,n),t.compileShader(e),e}function n(t,i,n){let e=i[0],o=i[1],s=i[2],r=i[3],h=i[4],c=i[5],u=i[6],a=i[7],l=i[8],f=i[9],d=i[10],m=i[11],v=i[12],w=i[13],p=i[14],_=i[15],M=n[0],T=n[1],x=n[2],g=n[3];return t[0]=M*e+T*h+x*l+g*v,t[1]=M*o+T*c+x*f+g*w,t[2]=M*s+T*u+x*d+g*p,t[3]=M*r+T*a+x*m+g*_,M=n[4],T=n[5],x=n[6],g=n[7],t[4]=M*e+T*h+x*l+g*v,t[5]=M*o+T*c+x*f+g*w,t[6]=M*s+T*u+x*d+g*p,t[7]=M*r+T*a+x*m+g*_,M=n[8],T=n[9],x=n[10],g=n[11],t[8]=M*e+T*h+x*l+g*v,t[9]=M*o+T*c+x*f+g*w,t[10]=M*s+T*u+x*d+g*p,t[11]=M*r+T*a+x*m+g*_,M=n[12],T=n[13],x=n[14],g=n[15],t[12]=M*e+T*h+x*l+g*v,t[13]=M*o+T*c+x*f+g*w,t[14]=M*s+T*u+x*d+g*p,t[15]=M*r+T*a+x*m+g*_,t}function e(t,i=[.9,.9,.9,1],n=16640){return(e,o)=>{e.i.o[o]|=1,e.i.h[o]={u:0,l:t,m:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],v:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p:[0,0,0],_:i,M:t.T,g:i,F:n}}}function o(t,i){let n=t.i.P[i],e=t.i.$[i];n.C&&(e.C[0]=n.C[0],e.C[1]=n.C[1],t.i.o[i]|=16),n.S&&(e.S=n.S,t.i.o[i]|=16)}function s(t,i,n){return t[0]=i[0]+n[0],t[1]=i[1]+n[1],t}function r(t,i,n){return t[0]=i[0]*n,t[1]=i[1]*n,t}function h(t,i,n){let e=t.i.X[i],o=t.i.$[i];if(o.C[0]||o.C[1]){S[0]=o.C[0],S[1]=o.C[1];let i=Math.min(1,Math.hypot((h=S)[0],h[1]));(function(t,i,n){let e=i[0],o=i[1];t[0]=n[0]*e+n[2]*o,t[1]=n[1]*e+n[3]*o})(S,S,void 0!==e.Y?t.i.X[e.Y].k:e.i),function(t,i){let n=i[0],e=i[1],o=n*n+e*e;o>0&&(o=1/Math.sqrt(o)),t[0]=i[0]*o,t[1]=i[1]*o}(S,S),r(S,S,i*o.A*n),s(e.I,e.I,S),o.C[0]=0,o.C[1]=0}var h;o.S&&(e.S+=o.S*o.D*n,o.S=0)}function c(t=0,i=1){return((X=16807*X%2147483647)-1)/2147483646*(i-t)+t}function u(t,i){return(n,e)=>{n.i.o[e]|=128,n.i.R[e]={u:t,V:i,K:[0,0],U:[0,0]}}}function a(t,i,n){let e=t.i.X[i],o=t.i.R[i];if(1===o.u){let i=-t.j/2/I;e.I[1]<i&&(e.I[1]=i,o.U[1]*=c(-3,-1))}}function l(t,i,n){let e=t.i.X[i],o=t.i.R[i];if(1===o.u){o.U[1]+=-9.81*n,r(o.K,o.K,n),s(o.U,o.U,o.K),r(o.U,o.U,o.V);let c=[0,0];r(c,o.U,n),s(e.I,e.I,c),t.i.o[i]|=16,(h=o.K)[0]=0,h[1]=0}var h}function f(t,i){let n=t.W;t.q.useProgram(n.G),t.q.uniformMatrix4fv(n.L.v,!1,i.v),t.q.activeTexture(33984),t.q.bindTexture(x,t.N["ziemniak.png"]),t.q.uniform1i(n.L.O,0),t.q.bindBuffer(T,t.B),t.q.bufferData(T,t.H,35040),t.q.drawArraysInstanced(n.J,0,4,t.i.o.length)}function d(t,i,n,e){let o=Math.sin(n),s=Math.cos(n);return t[0]=s*e[0],t[1]=o*e[0],t[2]=-o*e[1],t[3]=s*e[1],t[4]=i[0],t[5]=i[1],t}function m(t,i,n){var e,o;if(t.o[i]&=-17,d(n.i,n.I,n.S*Y,n.Z),void 0!==n.Y&&(function(t,i,n){let e=i[0],o=i[1],s=i[2],r=i[3],h=i[4],c=i[5],u=n[0],a=n[1],l=n[2],f=n[3],d=n[4],m=n[5];t[0]=e*u+s*a,t[1]=o*u+r*a,t[2]=e*l+s*f,t[3]=o*l+r*f,t[4]=e*d+s*m+h,t[5]=o*d+r*m+c}(n.i,t.X[n.Y].i,n.i),n.Gyroscope&&((e=b)[0]=(o=n.i)[4],e[1]=o[5],d(n.i,b,n.S*Y,n.Z))),function(t,i){let n=i[0],e=i[1],o=i[2],s=i[3],r=i[4],h=i[5],c=n*s-e*o;c&&(c=1/c,t[0]=s*c,t[1]=-e*c,t[2]=-o*c,t[3]=n*c,t[4]=(o*h-s*r)*c,t[5]=(e*r-n*h)*c)}(n.k,n.i),8&t.o[i]){let n=t.tt[i];for(let e=0;e<n.tt.length;e++){let o=n.tt[e];if(256&t.o[o]){let n=t.X[o];n.Y=i,m(t,o,n)}}}}function v(t,i,n,e){let o=~~(6*t),s=6*t-o,r=n*(1-i),h=n*(1-s*i),c=n*(1-(1-s)*i);switch(o%6){case 0:return[n,c,r,e];case 1:return[h,n,r,e];case 2:return[r,n,c,e];case 3:return[r,h,n,e];case 4:return[c,r,n,e];default:return[n,r,h,e]}}function w(t){return(i,n)=>{let e=n*k;i.H[e+6]=0,i.H[e+7]=1,i.H[e+8]=t[0],i.H[e+9]=t[1],i.H[e+10]=t[2],i.H[e+11]=t[3],i.i.o[n]|=64,i.i.it[n]={nt:i.H.subarray(e+6,e+8),et:i.H.subarray(e+8,e+12)}}}function p(t){return(i,n)=>{i.H[n*k+6]=t}}function _(t=[0,0],i=0,n=[1,1]){return(e,o)=>{e.i.o[o]|=272,e.i.X[o]={i:e.H.subarray(o*k,o*k+6),k:[1,0,0,1,0,0],I:t,S:i,Z:n,Gyroscope:!1}}}async function M(t,i){let n=await(e="../textures/"+i+".webp",new Promise((t=>{let i=new Image;i.src=e,i.onload=()=>t(i)})));var e;t.N[i]=function(t,i){let n=t.createTexture();return t.bindTexture(x,n),t.texImage2D(x,0,6408,6408,5121,i),t.generateMipmap(x),t.texParameteri(x,10241,9984),t.texParameteri(x,10240,9728),t.texParameteri(x,10242,10497),t.texParameteri(x,10243,10497),n}(t.q,n)}var T=34962,x=3553,g=5126,y=document.getElementById("update"),F=document.getElementById("delta"),P=document.getElementById("fps"),$=1/60,C=class extends class{constructor(t=1e4){this.o=[],this.ot=[],this.st=t}t(){return this.ot.length>0?this.ot.pop():this.o.push(0)-1}rt(t){this.o[t]=0,this.ot.push(t)}}{constructor(){super(...arguments),this.h=[],this.P=[],this.ht=[],this.tt=[],this.$=[],this.it=[],this.R=[],this.X=[]}},S=[0,0],X=1,Y=Math.PI/180,b=[0,0],k=16,A=4*k,I=32,z=Float32Array.from([-.5,-.5,0,0,0,.5,-.5,0,1,0,-.5,.5,0,0,1,.5,.5,0,1,1]),D=new class extends class extends class{constructor(){this.ct=0,this.ut=0,this.lt=window.innerWidth,this.j=window.innerHeight,this.ft=!0,this.dt={MouseX:0,MouseY:0},this.vt={MouseX:0,MouseY:0},this.wt={Mouse:0,Mouse0:0,Mouse1:0,Mouse2:0,Touch0:0,Touch1:0},this._t={},this.Mt=document.querySelector("main"),document.addEventListener("visibilitychange",(()=>document.hidden?this.Tt():this.xt())),this.Mt.addEventListener("contextmenu",(t=>t.preventDefault())),this.Mt.addEventListener("mousedown",(t=>{this.dt["Mouse"+t.button]=1,this.vt["Mouse"+t.button]=1})),this.Mt.addEventListener("mouseup",(t=>{this.dt["Mouse"+t.button]=0,this.vt["Mouse"+t.button]=-1})),this.Mt.addEventListener("mousemove",(t=>{this.dt.MouseX=t.clientX,this.dt.MouseY=t.clientY,this.vt.MouseX=t.movementX,this.vt.MouseY=t.movementY})),this.Mt.addEventListener("wheel",(t=>{t.preventDefault(),this.vt.WheelY=t.deltaY})),this.Mt.addEventListener("touchstart",(t=>{t.target===this.Mt&&t.preventDefault(),1===t.touches.length&&(this._t={});for(let i=0;i<t.touches.length;i++)this._t[t.touches[i].identifier]=i;for(let i=0;i<t.changedTouches.length;i++){let n=t.changedTouches[i],e=this._t[n.identifier];this.dt["Touch"+e]=1,this.dt[`Touch${e}X`]=n.clientX,this.dt[`Touch${e}Y`]=n.clientY,this.vt["Touch"+e]=1,this.vt[`Touch${e}X`]=0,this.vt[`Touch${e}Y`]=0}})),this.Mt.addEventListener("touchmove",(t=>{t.target===this.Mt&&t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){let n=t.changedTouches[i],e=this._t[n.identifier];this.vt[`Touch${e}X`]=n.clientX-this.dt[`Touch${e}X`],this.vt[`Touch${e}Y`]=n.clientY-this.dt[`Touch${e}Y`],this.dt[`Touch${e}X`]=n.clientX,this.dt[`Touch${e}Y`]=n.clientY}})),this.Mt.addEventListener("touchend",(t=>{t.target===this.Mt&&t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){let n=this._t[t.changedTouches[i].identifier];this.dt["Touch"+n]=0,this.vt["Touch"+n]=-1}})),this.Mt.addEventListener("touchcancel",(t=>{for(let i=0;i<t.changedTouches.length;i++){let n=this._t[t.changedTouches[i].identifier];this.dt["Touch"+n]=0,this.vt["Touch"+n]=-1}})),window.addEventListener("keydown",(t=>{t.repeat||(this.dt[t.code]=1,this.vt[t.code]=1)})),window.addEventListener("keyup",(t=>{this.dt[t.code]=0,this.vt[t.code]=-1}))}xt(){let t=0,i=performance.now(),n=e=>{let o=(e-i)/1e3;for(i=e,this.ct=requestAnimationFrame(n),this.gt(o),t+=o;t>=$;)t-=$,this.yt($);this.Ft(o),this.Pt(o)};this.Tt(),n(i)}Tt(){cancelAnimationFrame(this.ct),this.ct=0}gt(t){this.ut=performance.now();let i=Math.abs(this.vt.MouseX)+Math.abs(this.vt.MouseY);this.wt.Mouse+=i,1===this.dt.Mouse0&&(this.wt.Mouse0+=i),1===this.dt.Mouse1&&(this.wt.Mouse1+=i),1===this.dt.Mouse2&&(this.wt.Mouse2+=i),1===this.dt.Touch0&&(this.wt.Touch0+=Math.abs(this.vt.Touch0X)+Math.abs(this.vt.Touch0Y)),1===this.dt.Touch1&&(this.wt.Touch1+=Math.abs(this.vt.Touch1X)+Math.abs(this.vt.Touch1Y))}yt(t){}Ft(t){}Pt(t){this.ft=!1,-1===this.vt.Mouse0&&(this.wt.Mouse0=0),-1===this.vt.Mouse1&&(this.wt.Mouse1=0),-1===this.vt.Mouse2&&(this.wt.Mouse2=0),-1===this.vt.Touch0&&(this.wt.Touch0=0),-1===this.vt.Touch1&&(this.wt.Touch1=0);for(let t in this.vt)this.vt[t]=0;let i=performance.now()-this.ut;y&&(y.textContent=i.toFixed(1)),F&&(F.textContent=(1e3*t).toFixed(1)),P&&(P.textContent=(1/t).toFixed())}}{constructor(){super(),this.$t=document.querySelector("#billboard"),this.Ct=this.$t.getContext("2d"),this.St=document.querySelector("#scene"),this.q=this.St.getContext("webgl2"),this.Audio=new AudioContext,this.Xt=[],this.Yt={},this.q.enable(2929),this.q.enable(2884),this.q.blendFunc(770,771)}gt(t){super.gt(t),this.Xt=[]}}{constructor(){super(),this.i=new C(50001),this.W=function(t){let n=function(t,n,e){let o=t.createProgram();return t.attachShader(o,i(t,35633,"#version 300 es\n\nuniform mat4 pv;\n\n\nin vec4 attr_position;\nin vec2 attr_texcoord;\n\n\nin vec4 attr_rotation; \nin vec4 attr_translation; \nin vec4 attr_color;\n\nout vec4 vert_color;\nout vec2 vert_texcoord;\n\nvoid main() {\nmat4 world = mat4(\nattr_rotation.xy, 0, 0,\nattr_rotation.zw, 0, 0,\n0, 0, 1, 0,\nattr_translation.xyz, 1\n);\n\nvec4 world_position = world * attr_position;\ngl_Position = pv * world_position;\nif (attr_translation.w == 0.0) {\ngl_Position.z = 2.0;\n}\n\nvert_color = attr_color;\nvert_texcoord = attr_texcoord;\n}\n")),t.attachShader(o,i(t,35632,"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D sheet;\n\nin vec4 vert_color;\nin vec2 vert_texcoord;\n\nout vec4 frag_color;\n\nvoid main() {\nfrag_color = vert_color * texture(sheet, vert_texcoord);\nif (frag_color.a == 0.0) {\ndiscard;\n}\n}\n")),t.linkProgram(o),o}(t);return{J:5,G:n,L:{v:t.getUniformLocation(n,"pv"),i:t.getUniformLocation(n,"world"),O:t.getUniformLocation(n,"sheet"),bt:t.getAttribLocation(n,"attr_position"),kt:t.getAttribLocation(n,"attr_texcoord"),At:t.getAttribLocation(n,"attr_rotation"),It:t.getAttribLocation(n,"attr_translation"),zt:t.getAttribLocation(n,"attr_color")}}}(this.q),this.N={},this.H=new Float32Array(this.i.st*k),this.B=this.q.createBuffer();let t=this.W,n=this.q.createBuffer();this.q.bindBuffer(T,n),this.q.bufferData(T,z,35044),this.q.enableVertexAttribArray(t.L.bt),this.q.vertexAttribPointer(t.L.bt,3,g,!1,20,0),this.q.enableVertexAttribArray(t.L.kt),this.q.vertexAttribPointer(t.L.kt,2,g,!1,20,12),this.q.bindBuffer(T,this.B),this.q.bufferData(T,this.i.st*A,35040),this.q.enableVertexAttribArray(t.L.At),this.q.vertexAttribDivisor(t.L.At,1),this.q.vertexAttribPointer(t.L.At,4,g,!1,A,0),this.q.enableVertexAttribArray(t.L.It),this.q.vertexAttribDivisor(t.L.It,1),this.q.vertexAttribPointer(t.L.It,4,g,!1,A,16),this.q.enableVertexAttribArray(t.L.zt),this.q.vertexAttribDivisor(t.L.zt,1),this.q.vertexAttribPointer(t.L.zt,4,g,!1,A,32)}Ft(t){!function(t,i){if(t.lt==window.innerWidth&&t.j==window.innerHeight||(t.ft=!0),t.ft){t.lt=t.St.width=t.$t.width=window.innerWidth,t.j=t.St.height=t.$t.height=window.innerHeight;for(let i=0;i<t.i.o.length;i++)if(1==(1&t.i.o[i])){let o=t.i.h[i];if(0==o.u&&1==o.l.u){o.l.Dt=t.j/I/2,function(t,i,n,e,o,s,r){let h=1/(o-n),c=1/(e-i),u=1/(s-r);t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(o+n)*h,t[13]=(i+e)*c,t[14]=(r+s)*u,t[15]=1}((n=o.l).l,n.Dt,n.Dt*(e=t.lt/t.j),-n.Dt,-n.Dt*e,n.Rt,n.T),function(t,i){let n=i[0],e=i[1],o=i[2],s=i[3],r=i[4],h=i[5],c=i[6],u=i[7],a=i[8],l=i[9],f=i[10],d=i[11],m=i[12],v=i[13],w=i[14],p=i[15],_=n*h-e*r,M=n*c-o*r,T=n*u-s*r,x=e*c-o*h,g=e*u-s*h,y=o*u-s*c,F=a*v-l*m,P=a*w-f*m,$=a*p-d*m,C=l*w-f*v,S=l*p-d*v,X=f*p-d*w,Y=_*X-M*S+T*C+x*$-g*P+y*F;Y&&(Y=1/Y,t[0]=(h*X-c*S+u*C)*Y,t[1]=(o*S-e*X-s*C)*Y,t[2]=(v*y-w*g+p*x)*Y,t[3]=(f*g-l*y-d*x)*Y,t[4]=(c*$-r*X-u*P)*Y,t[5]=(n*X-o*$+s*P)*Y,t[6]=(w*T-m*y-p*M)*Y,t[7]=(a*y-f*T+d*M)*Y,t[8]=(r*S-h*$+u*F)*Y,t[9]=(e*$-n*S-s*F)*Y,t[10]=(m*g-v*T+p*_)*Y,t[11]=(l*T-a*g-d*_)*Y,t[12]=(h*P-r*C-c*F)*Y,t[13]=(n*C-e*P+o*F)*Y,t[14]=(v*M-m*x-w*_)*Y,t[15]=(a*x-l*M+f*_)*Y)}(n.Vt,n.l);break}}}var n,e}(this),function(t,i){for(let i=0;i<t.i.o.length;i++)if(257==(257&t.i.o[i])){let e=t.i.h[i];if(0!==e.u)throw Error("Only canvas cameras are supported.");let o=e.l,s=t.i.X[i];e.m[0]=s.k[0],e.m[1]=s.k[1],e.m[4]=s.k[2],e.m[5]=s.k[3],e.m[12]=s.k[4],e.m[13]=s.k[5],e.m[14]=-2,n(e.v,o.l,e.m),e.p[0]=s.i[4],e.p[1]=s.i[5],e.p[2]=2,t.Xt.push(i)}}(this),function(t,i){for(let i=0;i<t.i.o.length;i++)34==(34&t.i.o[i])&&o(t,i)}(this),function(t,i){for(let n=0;n<t.i.o.length;n++)304==(304&t.i.o[n])&&h(t,n,i)}(this,t),function(t,i){for(let n=0;n<t.i.o.length;n++)384==(384&t.i.o[n])&&l(t,n,i)}(this,t),function(t,i){for(let i=0;i<t.i.o.length;i++)272==(272&t.i.o[i])&&m(t.i,i,t.i.X[i])}(this),function(t,i){for(let i=0;i<t.i.o.length;i++)384==(384&t.i.o[i])&&a(t,i)}(this),function(t,i){for(let i=0;i<t.i.o.length;i++){let n=i*k+7;64&t.i.o[i]?0==t.H[n]&&(t.H[n]=1):1==t.H[n]&&(t.H[n]=0)}for(let i of t.Xt){let n=t.i.h[i];0===n.u&&(t.q.bindFramebuffer(36160,null),t.q.viewport(0,0,t.lt,t.j),t.q.clearColor(...n.g),t.q.clear(n.F),f(t,n))}}(this)}};window.game=D,Promise.all([M(D,"checker1.png"),M(D,"ziemniak.png")]).then((()=>{!function(i){i.i=new C(50001),i.ft=!0,t(i,[_([0,0]),e({u:1,Dt:5,Rt:1,T:3,l:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Vt:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]})]);for(let n=0;n<5e3;n++)t(i,[_([c(-10,10),c(9,10)],0),w(v(c(.1,.2),.5,1,1)),p(1-n/5e3),u(1,c(.98,.99))])}(D),D.xt()}))})();
